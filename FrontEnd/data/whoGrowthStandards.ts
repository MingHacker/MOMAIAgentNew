// WHO生长标准数据（0-24个月）
export const whoGrowthStandards = {
  weightForAge: {
    male: {
      months: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24],
      // P3 相当于 -2SD
      p3: [2.5, 3.4, 4.4, 5.1, 5.7, 6.1, 6.4, 6.7, 6.9, 7.1, 7.2, 7.4, 7.5, 7.8, 8.1, 8.3, 8.6, 8.8, 9.0],
      // P15 相当于 -1SD
      p15: [2.9, 3.9, 4.9, 5.6, 6.2, 6.7, 7.0, 7.3, 7.5, 7.7, 7.9, 8.1, 8.2, 8.5, 8.8, 9.1, 9.4, 9.6, 9.9],
      // P50 是中位数
      p50: [3.3, 4.5, 5.6, 6.4, 7.0, 7.5, 7.9, 8.3, 8.6, 8.9, 9.1, 9.3, 9.5, 9.9, 10.2, 10.5, 10.8, 11.1, 11.4],
      // P85 相当于 +1SD
      p85: [3.7, 5.0, 6.2, 7.1, 7.8, 8.4, 8.8, 9.2, 9.5, 9.8, 10.1, 10.3, 10.6, 11.0, 11.4, 11.8, 12.2, 12.5, 12.9],
      // P97 相当于 +2SD
      p97: [4.0, 5.4, 6.8, 7.7, 8.4, 9.0, 9.5, 9.9, 10.2, 10.5, 10.8, 11.1, 11.4, 11.9, 12.3, 12.8, 13.2, 13.6, 14.0]
    },
    female: {
      months: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24],
      p3: [2.4, 3.2, 4.0, 4.6, 5.1, 5.5, 5.8, 6.0, 6.2, 6.4, 6.6, 6.7, 6.9, 7.2, 7.5, 7.7, 8.0, 8.2, 8.4],
      p15: [2.8, 3.6, 4.5, 5.2, 5.7, 6.1, 6.4, 6.7, 6.9, 7.1, 7.3, 7.5, 7.6, 8.0, 8.3, 8.5, 8.8, 9.1, 9.3],
      p50: [3.2, 4.2, 5.1, 5.8, 6.4, 6.9, 7.3, 7.6, 7.9, 8.2, 8.4, 8.6, 8.8, 9.2, 9.6, 9.9, 10.2, 10.5, 10.8],
      p85: [3.6, 4.7, 5.7, 6.5, 7.2, 7.7, 8.1, 8.5, 8.8, 9.1, 9.4, 9.6, 9.9, 10.3, 10.7, 11.1, 11.5, 11.9, 12.2],
      p97: [3.9, 5.1, 6.2, 7.1, 7.8, 8.3, 8.8, 9.2, 9.6, 9.9, 10.2, 10.5, 10.8, 11.3, 11.7, 12.2, 12.6, 13.0, 13.4]
    }
  },
  heightForAge: {
    male: {
      months: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24],
      p3: [46.3, 51.1, 54.7, 57.6, 59.9, 61.8, 63.4, 64.8, 66.2, 67.4, 68.6, 69.7, 70.8, 72.8, 74.6, 76.3, 77.9, 79.4, 80.8],
      p15: [47.8, 52.7, 56.4, 59.3, 61.7, 63.7, 65.3, 66.8, 68.2, 69.5, 70.7, 71.9, 73.0, 75.1, 77.0, 78.8, 80.5, 82.1, 83.6],
      p50: [49.9, 54.7, 58.4, 61.4, 63.9, 65.9, 67.6, 69.2, 70.6, 72.0, 73.3, 74.5, 75.7, 77.9, 80.0, 81.9, 83.7, 85.4, 87.1],
      p85: [51.8, 56.7, 60.4, 63.5, 66.0, 68.0, 69.8, 71.4, 72.9, 74.3, 75.7, 77.0, 78.2, 80.5, 82.7, 84.7, 86.6, 88.4, 90.2],
      p97: [53.4, 58.4, 62.2, 65.3, 67.8, 70.0, 71.8, 73.5, 75.0, 76.5, 77.9, 79.2, 80.5, 82.9, 85.1, 87.2, 89.2, 91.1, 92.9]
    },
    female: {
      months: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24],
      p3: [45.6, 50.0, 53.2, 55.8, 58.0, 59.9, 61.5, 62.9, 64.3, 65.6, 66.8, 68.0, 69.1, 71.2, 73.1, 74.9, 76.5, 78.1, 79.6],
      p15: [47.0, 51.5, 54.9, 57.5, 59.8, 61.7, 63.4, 64.9, 66.3, 67.6, 68.9, 70.1, 71.3, 73.5, 75.5, 77.4, 79.1, 80.8, 82.4],
      p50: [49.1, 53.7, 57.1, 59.8, 62.1, 64.0, 65.7, 67.3, 68.7, 70.1, 71.5, 72.8, 74.0, 76.3, 78.4, 80.4, 82.3, 84.1, 85.7],
      p85: [51.1, 55.7, 59.2, 61.9, 64.3, 66.2, 68.0, 69.6, 71.1, 72.6, 74.0, 75.3, 76.6, 79.0, 81.2, 83.3, 85.3, 87.2, 89.0],
      p97: [52.7, 57.4, 61.0, 63.8, 66.2, 68.2, 70.0, 71.7, 73.2, 74.7, 76.2, 77.5, 78.9, 81.4, 83.7, 85.9, 88.0, 90.0, 91.9]
    }
  }
};

// 计算年龄（月）
export const calculateAgeInMonths = (birthDate: Date): number => {
  const today = new Date();
  const months = (today.getFullYear() - birthDate.getFullYear()) * 12 +
    (today.getMonth() - birthDate.getMonth());
  return months;
};

// 根据性别和月龄获取标准数据
export const getStandardsForAge = (
  gender: 'male' | 'female',
  ageInMonths: number,
  type: 'weight' | 'height'
) => {
  const standards = type === 'weight' ? 
    whoGrowthStandards.weightForAge[gender] : 
    whoGrowthStandards.heightForAge[gender];

  // 找到最接近的月龄索引
  const monthIndex = standards.months.findIndex(month => month >= ageInMonths);
  
  return {
    p3: standards.p3[monthIndex],
    p15: standards.p15[monthIndex],
    p50: standards.p50[monthIndex],
    p85: standards.p85[monthIndex],
    p97: standards.p97[monthIndex]
  };
};

// 评估生长状态
export const evaluateGrowthStatus = (
  value: number,
  gender: 'male' | 'female',
  ageInMonths: number,
  type: 'weight' | 'height'
): string => {
  const standards = getStandardsForAge(gender, ageInMonths, type);
  
  if (value < standards.p3) return 'Severely Underweight';
  if (value < standards.p15) return 'Underweight';
  if (value <= standards.p85) return 'Normal';
  if (value <= standards.p97) return 'Overweight';
  return 'Severely Overweight';
}; 